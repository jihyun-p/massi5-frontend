<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <title>Momogosso - Lunch Record</title>
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
        <script id="tailwind-config">
                tailwind.config = {
                    darkMode: "class",
                    theme: {
                        extend: {
                            colors: {
                                "primary": "#F35C1B",
                                "background-light": "#f8f7f6",
                                "background-dark": "#221910",
                            },
                        },
                    },
                }
        </script>    
        <style>
            body { font-family: 'Plus Jakarta Sans', 'Noto Sans KR', sans-serif; -webkit-font-smoothing: antialiased; }
            .no-scrollbar::-webkit-scrollbar { display: none; }
            .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
            
            .btn-active {
                background-color: #F35C1B !important;
                color: white !important;
                box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
                border-color: transparent !important;
            }

            @keyframes toast-slide {
                0% { transform: translate(-50%, 100%); opacity: 0; }
                15% { transform: translate(-50%, -20px); opacity: 1; }
                85% { transform: translate(-50%, -20px); opacity: 1; }
                100% { transform: translate(-50%, 100%); opacity: 0; }
            }
            .toast-animation { animation: toast-slide 3s ease-in-out forwards; }
        </style>
    </head>
    <body class="bg-background-light dark:bg-background-dark text-[#181411] dark:text-white overflow-hidden w-full h-screen relative flex justify-center">
        <div class="w-full max-w-[375px] h-full flex flex-col bg-white dark:bg-background-dark relative shadow-xl overflow-hidden">
            
            <header class="flex items-center justify-between px-5 pt-6 pb-2 bg-white dark:bg-[#221910] z-20 sticky top-0">
                <button onclick="history.back()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors -ml-2">
                    <span class="material-symbols-outlined text-[#181411] dark:text-white">arrow_back</span>
                </button>
                <h1 class="text-lg font-bold flex-1 text-center pr-8">점심 기록하기</h1>
            </header>

            <main class="flex-1 overflow-y-auto no-scrollbar px-5 pb-40">
                <section class="mb-5 mt-2">
                    <label class="block text-sm font-bold mb-2">메뉴 이름 <span class="text-primary">*</span></label>
                    <input class="w-full bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all font-medium" id="food-name" type="text" placeholder="오늘 뭐 드셨나요?"/>
                </section>

                <section class="mb-5" id="category-section">
                    <label class="block text-sm font-bold mb-2">어떤 종류인가요? <span class="text-primary">*</span></label>
                    <div class="flex flex-wrap gap-2">
                        <button class="cat-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all">한식</button>
                        <button class="cat-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all">중식</button>
                        <button class="cat-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all">일식</button>
                        <button class="cat-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all">양식</button>
                        <button class="cat-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all">분식</button>
                    </div>
                </section>

                <section class="mb-5" id="type-section">
                    <label class="block text-sm font-bold mb-2">어디서 드셨나요? <span class="text-primary">*</span></label>
                    <div class="flex flex-wrap gap-2">
                        <button data-type="외식" class="type-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">restaurant</span>외식
                        </button>
                        <button data-type="배달" class="type-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">pedal_bike</span>배달
                        </button>
                        <button data-type="집밥" class="type-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-50 dark:bg-white/5 text-gray-600 border border-transparent transition-all flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">skillet</span>집밥
                        </button>
                    </div>
                </section>

                <hr class="border-gray-100 dark:border-white/5 mb-6"/>

                <section class="mb-6">
                    <label class="block text-xs font-bold mb-2 text-gray-400">사진 추가 (선택)</label>
                    <input type="file" id="photo-input" accept="image/*" class="hidden">
                    <div id="photo-container" class="w-20 h-20 rounded-xl overflow-hidden relative border-2 border-dashed border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/5 flex flex-col items-center justify-center cursor-pointer">
                        <span class="material-symbols-outlined text-xl text-gray-400">add_a_photo</span>
                        <img id="photo-preview" src="" alt="" class="hidden absolute inset-0 w-full h-full object-cover"/>
                    </div>
                </section>

                <section class="mb-8">
                    <label class="block text-sm font-bold mb-2">오늘 내 점심 이야기 <span class="text-gray-400 font-normal ml-1">(선택)</span></label>
                    <textarea id="food-story" rows="8" class="w-full bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-2xl px-4 py-4 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all resize-none shadow-sm" placeholder="오늘 점심은 어떠셨나요? 특별한 일이 있었다면 썰을 풀어주세요!"></textarea>
                </section>

            </main>

            <div class="absolute bottom-0 left-0 right-0 p-5 bg-white dark:bg-[#221910] border-t border-[#f4f2f0] dark:border-[#3a2e24] z-30">
                <button id="submit-btn" disabled class="w-full h-14 bg-gray-200 dark:bg-gray-800 text-gray-400 font-bold text-lg rounded-2xl transition-all cursor-not-allowed">
                    기록 완료
                </button>            
            </div>

            <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 pointer-events-none w-full max-w-[340px] px-4 hidden">
                <div class="bg-gray-900 text-white px-5 py-3.5 rounded-xl shadow-2xl flex items-center gap-3 justify-center">
                    <span class="font-bold text-sm">기록이 성공적으로 저장됐어요!</span>
                </div>
            </div>
        </div>

        <script>
            let selectedCategory = '';
            let selectedType = '';

            const container = document.getElementById('photo-container');
            const input = document.getElementById('photo-input');
            const preview = document.getElementById('photo-preview');
            
            container.addEventListener('click', () => input.click());
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        preview.src = ev.target.result;
                        preview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });

            const catBtns = document.querySelectorAll('.cat-btn');
            catBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    catBtns.forEach(b => b.classList.remove('btn-active'));
                    btn.classList.add('btn-active');
                    selectedCategory = btn.innerText;
                    updateSubmitButton();
                });
            });

            const typeBtns = document.querySelectorAll('.type-btn');
            typeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    typeBtns.forEach(b => b.classList.remove('btn-active'));
                    btn.classList.add('btn-active');
                    selectedType = btn.getAttribute('data-type');
                    updateSubmitButton();
                });
            });

            const nameInput = document.getElementById('food-name');
            const submitBtn = document.getElementById('submit-btn');

            function updateSubmitButton() {
                if (nameInput.value.trim() && selectedCategory && selectedType) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                    submitBtn.classList.add('bg-primary', 'text-white', 'shadow-lg');
                } else {
                    submitBtn.disabled = true;
                    submitBtn.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                    submitBtn.classList.remove('bg-primary', 'text-white');
                }
            }

            nameInput.addEventListener('input', updateSubmitButton);

            // 버튼 클릭 이벤트 리스너 수정
            submitBtn.addEventListener('click', (e) => {
                e.preventDefault(); // 기본 이동 방지
                completeRecord(); // 저장 함수 실행
            });
            let isSubmitting = false;
            function completeRecord() {
                if (isSubmitting) return; // 이미 제출 중이면 무시
                isSubmitting = true;

                // 1. 실제 HTML에 있는 ID값으로 가져오기
                const foodName = document.getElementById('food-name').value;
                const foodStory = document.getElementById('food-story').value;
                const photoPreview = document.getElementById('photo-preview').src;
                
                // 내용이 없으면 간단하게 이름이라도 넣기
                const finalContent = foodStory || `${foodName} 맛있게 먹었습니다!`;

                // 2. 새 게시글 객체 만들기
                const newPost = {
                    postId: Date.now(), // 숫자가 매우 커서 무조건 맨 위로 올라감
                    author: { 
                        name: "나", 
                        level: "Lv.3 식객", 
                        profileImg: "https://api.dicebear.com/7.x/avataaars/svg?seed=me" 
                    },
                    timeAgo: "방금 전",
                    content: finalContent,
                    tags: [`#${selectedCategory}`, `#${selectedType}`, "#내가쓴글"],
                    // 사진이 있으면 넣고 없으면 null (문자열 "null" 체크 주의)
                    imageUrl: preview.classList.contains('hidden') ? null : preview.src,
                    reactions: { heart: 0, thumb: 0, clap: 0, smile: 0 },
                    userReactions: { heart: false, thumb: false, clap: false, smile: false }
                };

                // 3. 로컬 저장소 저장
                const localPosts = JSON.parse(localStorage.getItem('myPosts') || '[]');
                localPosts.unshift(newPost);
                localStorage.setItem('myPosts', JSON.stringify(localPosts));

                // 4. 토스트 알림 보여주기 (선택사항)
                const toast = document.getElementById('toast');
                toast.classList.remove('hidden');
                toast.classList.add('toast-animation');

                // 5. 잠시 후 이동 (커뮤니티 파일 이름 확인: Community.html)
                setTimeout(() => { 
                    location.href = 'Community.html'; 
                }, 1500);
            }
        </script>
    </body>
</html>