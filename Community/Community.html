<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <title>Momogosso - ì»¤ë®¤ë‹ˆí‹°</title>
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet"/>
        <script id="tailwind-config">
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            "primary": "#F35C1B",
                            "background-light": "#f8f7f6",
                            "background-dark": "#221910",
                        },
                        fontFamily: {
                            "display": ["Plus Jakarta Sans", "Noto Sans KR", "sans-serif"],
                            "sans": ["Plus Jakarta Sans", "Noto Sans KR", "sans-serif"],
                        },
                        borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "full": "9999px"},
                    },
                },
            }
        </script>
        <style>
            body { font-family: 'Plus Jakarta Sans', 'Noto Sans KR', sans-serif; -webkit-font-smoothing: antialiased; min-height: max(884px, 100dvh); }
            .no-scrollbar::-webkit-scrollbar {display: none;}
            .no-scrollbar {-ms-overflow-style: none; scrollbar-width: none;}
            .tab-active { background-color: #F35C1B !important; color: white !important; border-color: #F35C1B !important; }
            .post-card-shadow { background: white; border-radius: 24px; border: 1px solid #f4f2f0; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
            .reaction-btn { display: flex; align-items: center; gap: 4px; padding: 6px 10px; border-radius: 12px; background: #f9f8f7; color: #897561; transition: all 0.2s; }
            .reaction-btn:active { transform: scale(0.9); } 
            .reaction-btn.active { background-color: #F35C1B !important; color: white !important; }
            .reaction-btn.active span { color: white !important; }
            .reaction-btn .count { font-size: 12px; font-weight: 600; }
            .filter-menu { display: none; position: absolute; top: 30px; right: 0; background: white; border: 1px solid #f4f2f0; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 100; min-width: 100px; }
            .filter-menu.show { display: block; }
            .filter-menu button { width: 100%; padding: 10px 16px; text-align: left; font-size: 13px; color: #897561; }
            .filter-menu button:hover { background: #f9f8f7; color: #F35C1B; }
            
            /* ìˆ˜ì •ëœ ì‚­ì œ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
            .delete-menu { 
                position: absolute; 
                right: 0; 
                top: 35px; 
                background: white; 
                border: 1px solid #eee; 
                border-radius: 12px; 
                box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
                z-index: 50; 
                overflow: hidden; 
                /* í•µì‹¬: ê¸€ìê°€ ì•„ë˜ë¡œ ë°€ë¦¬ì§€ ì•Šê²Œ ë°©ì§€í•˜ê³  ë„ˆë¹„ í™•ë³´ */
                white-space: nowrap; 
                min-width: 110px; 
            }

            /* ë©”ë‰´ ë‚´ë¶€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì •ë ¬ ìµœì í™” */
            .delete-menu button {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                padding: 12px 16px;
                width: 100%;
                transition: background 0.2s;
            }

            /* í† ìŠ¤íŠ¸ ë° íŒì—… ì• ë‹ˆë©”ì´ì…˜ (ì„¤ì • í˜ì´ì§€ì™€ ë™ì¼) */
            @keyframes toast-slide {
                0% { transform: translate(-50%, 100%); opacity: 0; }
                15% { transform: translate(-50%, -20px); opacity: 1; }
                85% { transform: translate(-50%, -20px); opacity: 1; }
                100% { transform: translate(-50%, 100%); opacity: 0; }
            }
            .toast-animation { animation: toast-slide 2.5s ease-in-out forwards; }
        </style>
    </head>
   <body class="bg-background-light dark:bg-background-dark text-[#181411] dark:text-white overflow-hidden w-full h-screen relative flex justify-center">
    <div class="w-full max-w-[480px] h-full flex flex-col bg-background-light dark:bg-background-dark relative shadow-xl overflow-hidden">
            
            <header class="p-6 pb-2 bg-[#f8f7f6]/95 sticky top-0 z-50">
                <h1 class="text-2xl font-bold text-[#181411]">ì»¤ë®¤ë‹ˆí‹°</h1>
                <p class="text-sm text-[#897561] mt-1">ëˆ„êµ¬ë‚˜ í¸í•˜ê²Œ ì˜¬ë¦¬ëŠ” ì‹ì‚¬ ê¸°ë¡</p>
                
                <div id="category-tabs" class="flex gap-2 mt-4 overflow-x-auto no-scrollbar pb-2">
                    <button onclick="changeCategory('ì „ì²´')" class="tab-btn px-4 py-2 bg-white border border-[#e5e0db] text-[#897561] rounded-full text-sm whitespace-nowrap transition-all">ì „ì²´</button>
                    <button onclick="changeCategory('í•œì‹')" class="tab-btn px-4 py-2 bg-white border border-[#e5e0db] text-[#897561] rounded-full text-sm whitespace-nowrap transition-all">ğŸš í•œì‹</button>
                    <button onclick="changeCategory('ì–‘ì‹')" class="tab-btn px-4 py-2 bg-white border border-[#e5e0db] text-[#897561] rounded-full text-sm whitespace-nowrap transition-all">ğŸ ì–‘ì‹</button>
                    <button onclick="changeCategory('ì¤‘ì‹')" class="tab-btn px-4 py-2 bg-white border border-[#e5e0db] text-[#897561] rounded-full text-sm whitespace-nowrap transition-all">ğŸœ ì¤‘ì‹</button>
                    <button onclick="changeCategory('ì¼ì‹')" class="tab-btn px-4 py-2 bg-white border border-[#e5e0db] text-[#897561] rounded-full text-sm whitespace-nowrap transition-all">ğŸ± ì¼ì‹</button>
                </div>
            </header>

            <main id="main-content" class="flex-1 overflow-y-auto px-6 pb-24 no-scrollbar">
                <div class="flex justify-end my-4 relative" id="sort-container">
                    <button onclick="toggleFilterMenu()" class="flex items-center gap-1 text-[#897561]">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 7H21M6 12H18M10 17H14" stroke="#897561" stroke-width="2" stroke-linecap="round"/></svg>
                        <span id="current-sort-text" class="text-xs font-medium">ìµœì‹ ìˆœ</span>
                    </button>
                    
                    <div id="filter-menu" class="filter-menu">
                        <button onclick="changeSort('latest')">ìµœì‹ ìˆœ</button>
                        <button onclick="changeSort('popular')">ì¸ê¸°ìˆœ</button>
                    </div>
                </div>

                <div id="post-list" class="space-y-6"></div>

                <div id="empty-state" class="hidden flex-1 flex flex-col items-center justify-center py-20 text-center">
                    <div class="flex items-center justify-center mb-10">
                        <div style="width: 192px; height: 192px; position: relative">
                            <div style="width: 192px; height: 192px; left: 0px; top: 0px; position: absolute; background: #F3F4F6; border-radius: 9999px"></div>
                            <div style="width: 144px; height: 144px; left: 24px; top: 24px; position: absolute; background: white; box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.05); border-radius: 9999px; justify-content: center; align-items: center; display: flex">
                                <span class="material-symbols-outlined" style="font-size: 54px; color: #D1C5BC; font-variation-settings: 'wght' 300;">ramen_dining</span>
                            </div>
                            <div style="width: 12px; height: 12px; left: 148px; top: 32px; position: absolute; opacity: 0.60; background: #F35C1B; border-radius: 9999px"></div>           
                            <div style="width: 8px; height: 8px; left: 40px; top: 144px; position: absolute; opacity: 0.40; background: #F35C1B; border-radius: 9999px"></div>
                        </div>
                    </div>
                    <h2 class="text-[22px] font-bold text-[#181411] mb-2">ì•„ì§ ì´ ì¹´í…Œê³ ë¦¬ ê¸°ë¡ì´ ì—†ì–´ìš”</h2>
                    <p id="empty-msg" class="text-[#897561] mb-10">ê°€ì¥ ë¨¼ì € ë§›ìˆëŠ” ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>

                    <div onclick="location.href='new_record.html'" 
                        style="width: 280px; height: 56px; background: #F35C1B; border-radius: 24px; justify-content: center; align-items: center; gap: 8px; display: inline-flex; cursor: pointer; box-shadow: 0px 4px 6px -4px rgba(243, 92, 27, 0.30), 0px 10px 15px -3px rgba(243, 92, 27, 0.30);">
                        <span class="material-symbols-outlined" style="color: white; font-size: 20px;">edit</span>
                        <span style="color: white; font-size: 16px; font-family: 'Noto Sans KR'; font-weight: 700; line-height: 24px; white-space: nowrap;">
                            ì˜¤ëŠ˜ ì ì‹¬ ê¸°ë¡í•˜ëŸ¬ ê°€ê¸°
                        </span>
                    </div>
                </div>
            </main>

            <button onclick="location.href='new_record.html'" 
                class="fixed bottom-24 right-[calc(50%-220px)] sm:right-[calc(50%-210px)] w-14 h-14 bg-primary text-white rounded-full shadow-[0_8px_30px_rgb(243,92,27,0.4)] flex items-center justify-center z-[100] active:scale-95 transition-all">
                <span class="material-symbols-outlined" style="font-size: 28px;">edit_square</span>
            </button>

            <nav class="absolute bottom-0 left-0 right-0 bg-white dark:bg-[#1E160F] border-t border-[#f4f2f0] dark:border-[#3a2e24] px-6 pb-6 pt-3 flex justify-between items-center z-50">
                <a class="flex flex-col items-center justify-center gap-1 min-w-[64px] group" href="../Home/home.html">
                    <div class="text-[#9CA3AF] group-hover:text-primary flex items-center justify-center transition-transform group-active:scale-95">
                        <span class="material-symbols-outlined">home</span>
                    </div>
                    <span class="text-xs font-medium text-[#9CA3AF] group-hover:text-primary">í™ˆ</span>
                </a>
                <a class="flex flex-col items-center justify-center gap-1 min-w-[64px] group" href="../Record/record.html">
                    <div class="text-[#9CA3AF] group-hover:text-primary flex items-center justify-center transition-transform group-active:scale-95">
                        <span class="material-symbols-outlined">edit_square</span>
                    </div>
                    <span class="text-xs font-medium text-[#9CA3AF] group-hover:text-primary">ê¸°ë¡</span>
                </a>
                <a class="flex flex-col items-center justify-center gap-1 min-w-[64px] group" href="../Community/Community.html">
                    <div class="text-primary flex items-center justify-center transition-transform group-active:scale-95">
                        <span class="material-symbols-outlined fill-current" style="font-variation-settings: 'FILL' 1;">group</span>
                    </div>
                    <span class="text-xs font-bold text-primary">ì»¤ë®¤ë‹ˆí‹°</span>
                </a>
                <a class="flex flex-col items-center justify-center gap-1 min-w-[64px] group" href="../MyPage/Mypage.html">
                    <div class="text-[#9CA3AF] group-hover:text-primary flex items-center justify-center transition-transform group-active:scale-95">
                        <span class="material-symbols-outlined">person</span>
                    </div>
                    <span class="text-xs font-medium text-[#9CA3AF] group-hover:text-primary">ë§ˆì´í˜ì´ì§€</span>
                </a>
            </nav>

            <div id="delete-overlay" class="fixed inset-0 bg-black/40 backdrop-blur-[2px] z-[110] opacity-0 pointer-events-none transition-opacity duration-300" onclick="closeDeletePopup()"></div>
            <div id="delete-popup" class="fixed bottom-0 left-0 right-0 max-w-[480px] mx-auto bg-white dark:bg-[#2A2018] rounded-t-[32px] p-6 pb-12 z-[120] transform translate-y-full transition-transform duration-300 shadow-[0_-8px_30px_rgb(0,0,0,0.12)]">
                <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-8"></div>
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-red-50 dark:bg-red-900/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="material-symbols-outlined text-red-500 text-3xl">delete</span>
                    </div>
                    <h2 class="text-xl font-bold dark:text-white">ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
                    <p class="text-sm text-gray-500 mt-2">ì‚­ì œëœ ê¸°ë¡ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìœ¼ë©°<br>ì»¤ë®¤ë‹ˆí‹° ëª©ë¡ì—ì„œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeDeletePopup()" class="flex-1 h-14 bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-300 font-bold rounded-2xl transition-all active:scale-95">ì·¨ì†Œ</button>
                    <button id="confirm-delete-btn" class="flex-1 h-14 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-500/20 transition-all active:scale-95">ì‚­ì œí•˜ê¸°</button>
                </div>
            </div>

            <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-[100] pointer-events-none w-full max-w-[340px] px-4 hidden">
                <div class="bg-[#181411] dark:bg-white text-white dark:text-[#181411] px-5 py-3.5 rounded-xl shadow-2xl flex items-center gap-3 justify-center">
                    <div class="w-5 h-5 bg-green-500 rounded-full flex items-center justify-center text-white shrink-0">
                        <span class="material-symbols-outlined text-[14px] font-bold">check</span>
                    </div>
                    <span id="toast-message" class="font-bold text-sm">ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤</span>
                </div>
            </div>

        </div>

        <script>
            const communityData = [
                {
                    postId: 101,
                    author: { name: "ë©´ì¹˜ê¸°ë‹¬ì¸", level: "Lv.4 ë¯¸ì‹ê°€", profileImg: "https://api.dicebear.com/7.x/avataaars/svg?seed=Noodle" },
                    timeAgo: "10ë¶„ ì „",
                    content: "ì˜¤ëŠ˜ ì ì‹¬ì€ íšŒì‚¬ ê·¼ì²˜ ìƒˆë¡œ ìƒê¸´ ë¼ë©˜ì§‘ ê°”ëŠ”ë° ëŒ€ë°•ì´ë„¤ìš”! êµ­ë¬¼ì´ ì§„ì§œ ì°í•˜ê³  ì°¨ìŠˆê°€ ì…ì—ì„œ ë…¹ì•„ìš” ğŸœ ë‹¤ë“¤ ë§›ì í•˜ì…¨ë‚˜ìš”?",
                    tags: ["#ì ì‹¬ì¶”ì²œ", "#ë¼ë©˜", "#ì¤‘ì‹"],
                    imageUrl: "https://images.unsplash.com/photo-1557872943-16a5ac26437e?auto=format&fit=crop&w=600&q=80",
                    reactions: { heart: 12, thumb: 5, clap: 3, smile: 2 },
                    userReactions: { heart: false, thumb: false, clap: false, smile: false }
                },
                {
                    postId: 102,
                    author: { name: "ë‹¤ì´ì–´í„°_ì§€ìœ¤", level: "Lv.2 ìƒˆì‹¹", profileImg: "https://api.dicebear.com/7.x/avataaars/svg?seed=Diet" },
                    timeAgo: "1ì‹œê°„ ì „",
                    content: "ì–´ì œ ê³¼ì‹í•´ì„œ ì˜¤ëŠ˜ì€ ê°€ë³ê²Œ í¬ì¼€ ìƒëŸ¬ë“œë¡œ í•©ì˜ ë´¤ìŠµë‹ˆë‹¤ ğŸ¥² ì—°ì–´ ì¶”ê°€ëŠ” ëª» ì°¸ì£ ! ì˜¤í›„ì— ë°°ê³ í”Œê¹Œ ë´ ë²Œì¨ ê±±ì •ë˜ë„¤ìš”...",
                    tags: ["#ì‹ë‹¨ê´€ë¦¬", "#í¬ì¼€", "#ì–‘ì‹"],
                    imageUrl: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=600&q=80",
                    reactions: { heart: 8, thumb: 2, clap: 1, smile: 5 },
                    userReactions: { heart: false, thumb: false, clap: false, smile: false }
                },
                {
                    postId: 103,
                    author: { name: "í˜¼ë°¥ë§ˆìŠ¤í„°", level: "Lv.5 ì©ì©ë°•ì‚¬", profileImg: "https://api.dicebear.com/7.x/avataaars/svg?seed=Master" },
                    timeAgo: "3ì‹œê°„ ì „",
                    content: "ë¹„ ì˜¤ëŠ” ë‚ ì—” ì—­ì‹œ íŒŒì „ì— ë§‰ê±¸ë¦¬...ê°€ ì•„ë‹ˆë¼ ê¹€ì¹˜ë³¶ìŒë°¥ì´ì£ . ì§‘ì—ì„œ ëšë”± ë§Œë“¤ì—ˆëŠ”ë° ë°˜ìˆ™ ê³„ë€í›„ë¼ì´ê°€ ì˜ˆìˆ ë¡œ ëìŠµë‹ˆë‹¤ ğŸ³",
                    tags: ["#ì§‘ë°¥", "#ê¹€ì¹˜ë³¶ìŒë°¥", "#í•œì‹"],
                    imageUrl: null, 
                    reactions: { heart: 20, thumb: 10, clap: 5, smile: 8 },
                    userReactions: { heart: false, thumb: false, clap: false, smile: false }
                }
            ];

            let currentCategory = 'ì „ì²´';
            let currentSort = 'latest';
            let allData = [];
            let pendingDeleteId = null; // ì‚­ì œ ëŒ€ê¸° ì¤‘ì¸ ID

            function loadLocalPosts() {
                const localPosts = JSON.parse(localStorage.getItem('myPosts') || '[]');
                const markedLocalPosts = localPosts.map(p => ({...p, isMine: true}));
                allData = [...markedLocalPosts, ...communityData];
            }

            function renderPosts(filter = 'ì „ì²´') {
                const postList = document.getElementById('post-list');
                const emptyState = document.getElementById('empty-state');
                const sortContainer = document.getElementById('sort-container');
                
                postList.innerHTML = '';
                
                let filteredData = filter === 'ì „ì²´' 
                    ? [...allData] 
                    : allData.filter(post => post.tags.some(tag => tag.includes(filter)));

                if (currentSort === 'popular') {
                    filteredData.sort((a, b) => {
                        const sumA = Object.values(a.reactions).reduce((acc, curr) => acc + curr, 0);
                        const sumB = Object.values(b.reactions).reduce((acc, curr) => acc + curr, 0);
                        return sumB - sumA;
                    });
                } else {
                    filteredData.sort((a, b) => Number(b.postId) - Number(a.postId));
                }

                if (filteredData.length === 0) {
                    postList.classList.add('hidden');
                    sortContainer.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    document.getElementById('empty-msg').innerText = `'${filter}' ì¹´í…Œê³ ë¦¬ì— ë“±ë¡ëœ ê¸°ë¡ì´ ì•„ì§ ì—†ì–´ìš”.`;
                    return;
                }

                postList.classList.remove('hidden');
                sortContainer.classList.remove('hidden');
                emptyState.classList.add('hidden');

                filteredData.forEach(post => {
                    const hasImage = post.imageUrl ? `
                        <div class="w-full h-56 mt-4 rounded-2xl overflow-hidden border border-gray-100">
                            <img src="${post.imageUrl}" class="w-full h-full object-cover" alt="ì‹ë‹¨ ì´ë¯¸ì§€">
                        </div>` : '';

                    const tagsHtml = post.tags.map(tag => `
                        <span class="text-xs font-medium text-primary bg-primary/5 px-2.5 py-1 rounded-lg">${tag}</span>
                    `).join('');

                    const moreMenu = post.isMine ? `
                        <div class="relative">
                            <button onclick="toggleDeleteMenu(event, ${post.postId})" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">
                                <span class="material-symbols-outlined text-[#D1C5BC]">more_horiz</span>
                            </button>
                            <div id="delete-menu-${post.postId}" class="delete-menu hidden">
                                <button onclick="openDeletePopup(${post.postId})" class="w-full px-4 py-3 text-sm text-red-500 font-bold hover:bg-red-50 flex items-center gap-2">
                                    <span class="material-symbols-outlined text-sm">delete</span>ì‚­ì œí•˜ê¸°
                                </button>
                            </div>
                        </div>
                    ` : `<span class="material-symbols-outlined text-[#D1C5BC]">more_horiz</span>`;

                    const postHtml = `
                        <div class="post-card-shadow p-5 animate-in fade-in slide-in-from-bottom-4 duration-500 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <img src="${post.author.profileImg}" class="w-10 h-10 rounded-full bg-gray-100">
                                    <div>
                                        <p class="text-sm font-bold text-[#181411]">${post.author.name}</p>
                                        <p class="text-[11px] text-[#897561]">${post.author.level} Â· ${post.timeAgo}</p>
                                    </div>
                                </div>
                                ${moreMenu}
                            </div>
                            <p class="text-[15px] leading-relaxed text-[#181411]">${post.content}</p>
                            ${hasImage}
                            <div class="flex flex-wrap gap-2 mt-4">${tagsHtml}</div>
                            <div class="flex items-center gap-2 mt-5 pt-4 border-t border-[#f4f2f0]">
                                <button onclick="handleReaction(${post.postId}, 'heart')" class="reaction-btn ${post.userReactions.heart ? 'active' : ''}">
                                    <span class="material-symbols-outlined ${post.userReactions.heart ? '' : 'text-red-500'}">favorite</span>
                                    <span class="count">${post.reactions.heart}</span>
                                </button>
                                <button onclick="handleReaction(${post.postId}, 'thumb')" class="reaction-btn ${post.userReactions.thumb ? 'active' : ''}">
                                    <span class="material-symbols-outlined ${post.userReactions.thumb ? '' : 'text-blue-500'}">thumb_up</span>
                                    <span class="count">${post.reactions.thumb}</span>
                                </button>
                                <button onclick="handleReaction(${post.postId}, 'clap')" class="reaction-btn ${post.userReactions.clap ? 'active' : ''}">
                                    <span class="material-symbols-outlined ${post.userReactions.clap ? '' : 'text-orange-400'}">celebration</span>
                                    <span class="count">${post.reactions.clap}</span>
                                </button>
                                <button onclick="handleReaction(${post.postId}, 'smile')" class="reaction-btn ${post.userReactions.smile ? 'active' : ''}">
                                    <span class="material-symbols-outlined ${post.userReactions.smile ? '' : 'text-yellow-500'}">sentiment_satisfied</span>
                                    <span class="count">${post.reactions.smile}</span>
                                </button>
                            </div>
                        </div>`;
                    postList.insertAdjacentHTML('beforeend', postHtml);
                });
            }

            // --- íŒì—… & í† ìŠ¤íŠ¸ ë¡œì§ (ìˆ˜ì •ëœ ë¶€ë¶„) ---
            function openDeletePopup(postId) {
                pendingDeleteId = postId;
                document.getElementById('delete-overlay').classList.add('opacity-100', 'pointer-events-auto');
                document.getElementById('delete-popup').classList.remove('translate-y-full');
            }

            function closeDeletePopup() {
                document.getElementById('delete-overlay').classList.remove('opacity-100', 'pointer-events-auto');
                document.getElementById('delete-popup').classList.add('translate-y-full');
                pendingDeleteId = null;
            }

            document.getElementById('confirm-delete-btn').addEventListener('click', function() {
                if (pendingDeleteId) {
                    deletePost(pendingDeleteId);
                    closeDeletePopup();
                    showToast("ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤");
                }
            });

            function showToast(msg) {
                const toast = document.getElementById('toast');
                const toastMsg = document.getElementById('toast-message');
                toastMsg.innerText = msg;
                toast.classList.remove('hidden');
                toast.classList.add('toast-animation');
                setTimeout(() => {
                    toast.classList.add('hidden');
                    toast.classList.remove('toast-animation');
                }, 2500);
            }
            // ------------------------------------

            function deletePost(postId) {
                let localPosts = JSON.parse(localStorage.getItem('myPosts') || '[]');
                localPosts = localPosts.filter(p => p.postId !== postId);
                localStorage.setItem('myPosts', JSON.stringify(localPosts));
                loadLocalPosts();
                renderPosts(currentCategory);
            }

            function toggleDeleteMenu(event, postId) {
                event.stopPropagation();
                document.querySelectorAll('.delete-menu').forEach(menu => {
                    if (menu.id !== `delete-menu-${postId}`) menu.classList.add('hidden');
                });
                const menu = document.getElementById(`delete-menu-${postId}`);
                menu.classList.toggle('hidden');
            }

            function changeCategory(category) {
                currentCategory = category;
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('tab-active'));
                const activeTab = Array.from(document.querySelectorAll('.tab-btn')).find(btn => btn.innerText.includes(category));
                if (activeTab) activeTab.classList.add('tab-active');
                renderPosts(category);
            }

            function toggleFilterMenu() {
                document.getElementById('filter-menu').classList.toggle('show');
            }

            function changeSort(sortType) {
                currentSort = sortType;
                document.getElementById('current-sort-text').innerText = sortType === 'latest' ? 'ìµœì‹ ìˆœ' : 'ì¸ê¸°ìˆœ';
                document.getElementById('filter-menu').classList.remove('show');
                renderPosts(currentCategory);
            }

            function handleReaction(postId, type) {
                const post = allData.find(p => p.postId === postId);
                if (!post) return;
                const isAlreadyPressed = post.userReactions[type];
                post.reactions[type] += isAlreadyPressed ? -1 : 1;
                post.userReactions[type] = !isAlreadyPressed;
                renderPosts(currentCategory); 
            }

            window.onload = () => {
                loadLocalPosts();
                changeCategory('ì „ì²´');
            };

            window.onclick = function(event) {
                if (!event.target.closest('#sort-container')) {
                    const menu = document.getElementById('filter-menu');
                    if(menu) menu.classList.remove('show');
                }
                if (!event.target.closest('.relative')) {
                    document.querySelectorAll('.delete-menu').forEach(menu => menu.classList.add('hidden'));
                }
            }
        </script>
    </body>
</html>